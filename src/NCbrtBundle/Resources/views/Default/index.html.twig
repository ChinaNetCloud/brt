{% extends 'general.html.twig' %}

{% block title %}
    {{parent()}}
    - Home{% endblock %}

{% block dynamic_content %}
    <div class="row">
        <div class="col-lg-2">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">Search</h3>
                </div>
                <div class="panel-body">
                    {{ form_start(form) }}
                    {{ form_errors(form) }}
                    {{ form_label(form.name)}}
                    {{ form_widget(form.name) }}
                    {{ form_errors(form.name)}}
                    {{ form_label(form.method)}}
                    {{ form_widget(form.method) }}
                    {{ form_errors(form.method)}}
                    {{ form_label(form.status)}}
                    {{ form_widget(form.status) }}
                    {{ form_errors(form.status)}}
                    {{ form_label(form.comparer)}}
                    {{ form_widget(form.comparer) }}
                    {{ form_errors(form.comparer)}}
                    {{ form_label(form.size)}}
                    {{ form_widget(form.size) }}
                    {{ form_errors(form.size)}}
                    {{ form_label(form.date_start)}}
                    {{ form_widget(form.date_start)}}
                    {{ form_errors(form.date_start)}}
                    {{ form_label(form.date_end)}}
                    {{ form_widget(form.date_end)}}
                    {{ form_errors(form.date_end)}}
                    {{ form_label(form.count)}}
                    {{ form_widget(form.count) }}
                    {{ form_errors(form.count)}}
                    {{ form_label(form.active)}}
                    {{ form_widget(form.active) }}
                    {{ form_errors(form.active)}}
                    {{ form_widget(form.search, {'attr': {'class': 'btn btn-info'}}) }}
                    {{ form_end(form) }}
                </div>
                <div class="panel-footer">
                    <a class="btn btn-primary" href="{{path('export_excel', {'paramaters': paramaters})}}">Excel Export</a>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-tasks fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <div class="huge">Last 24 hours</div>
                            <div>Total backup executed:
                                {{ succeful[0][1] + warning[0][1] + failed[0][1]}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-2 col-md-5">
            <div class="panel panel-green">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-2">
                            <i class="fa fa-check-circle-o fa-5x"></i>
                        </div>
                        <div class="col-xs-10 text-right">
                            <div class="huge">{{ succeful[0][1] }}</div>
                            <div>Success!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-2 col-md-5">
            <div class="panel panel-yellow">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-2">
                            <i class="fa fa-warning fa-5x"></i>
                        </div>
                        <div class="col-xs-10 text-right">
                            <div class="huge">{{ warning[0][1] }}</div>
                            <div>Warning!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-2 col-md-5">
            <div class="panel panel-red">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-2">
                            <i class="fa fa-close fa-5x"></i>
                        </div>
                        <div class="col-xs-10 text-right">
                            <div class="huge">{{ failed[0][1] }}</div>
                            <div>Failed!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-10">
            <div class="panel panel-default">
                <div class="panel-heading">Total records:
                    {{pagination.getTotalItemCount}}</div>
                {% if pagination is defined and pagination is not empty %}
                    <table class="table">
                        <tr>
                            <td>#</td>
                            <td>Actions</td>
                            <td>{{ knp_pagination_sortable(pagination, 'Server Name', 's.name') }}</td>
                            <td>{{ knp_pagination_sortable(pagination, 'Date created', 'n.dateCreated') }}</td>
                            <td>{{ knp_pagination_sortable(pagination, 'Execution Status', 'n.success') }}</td>
                            <td>{{ knp_pagination_sortable(pagination, 'Size', 'n.backupsize') }}</td>
                            <td>{{ knp_pagination_sortable(pagination, 'Backup Method', 'n.backupmethod') }}</td>
                            <td>Production</td>
                        </tr>
                        {% for key, row in pagination %}
                            <tr>
                                <td>{{ (current_page - 1) * count + key + 1 }}</td>
                                <td>
                                    <a href="{{ path('event_by_id', {'event_id': row.id}) }}">View
                                        <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></a>
                                    </td>
                                    <td>
                                        <a href="{{ path('edit_server', {'id': row.srvrsservers.id}) }}">Edit
                                            <span class="glyphicon glyphicon-edit" aria-hidden="true"></span></a>
                                        |
                                        {{ row.srvrsservers.name }}
                                    </td>
                                    <td>{{ row.dateCreated is empty ? "" : row.dateCreated | date("m/d/Y H:i:s")}}</td>
                                    <td>{{ row.success == '0' ? "<span class='badge badge-success btn-group-justified'>Success</span>" 
                                    : row.success == '1' ? "<span class='badge badge-error btn-group-justified'>Failed</span>" 
                                    : "<span class='badge badge-warning btn-group-justified'>Warning</span>"}}</td>
                                    <td>
                                        {% if row.backupsize < 1048576 and row.backupsize > 1024 %}
                                            {{ (row.backupsize / 1024) |number_format(2, '.', '')}}
                                            MB
                                        {% elseif row.backupsize < 1024 %}
                                            {{ row.backupsize  |number_format(2, '.', '')}}
                                            KB
                                        {% else %}
                                            {{ (row.backupsize / 1024 / 1024 )| number_format(2, '.', '')}}
                                            GB
                                        {% endif %}
                                    </td>
                                    <td>{{ row.backupmethod == "ncscript-py" ? "nc-backup-py" : row.backupmethod }}</td>
                                    <td>{{ row.srvrsservers.statusactive == '1' ? "Active" : "Not Active" }}</td>
                                </tr>
                            {% endfor %}
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert-warning" role="alert">
                        <h4>No search results available for this criteria!</h4>
                    </div>
                {% endif %}
                <div class="pagination">
                    {{ knp_pagination_render(pagination) }}
                </div>
            </div>
        </div>
    {% endblock %}